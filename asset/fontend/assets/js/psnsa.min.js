/*  
---------------------------------------------------------------------------
*  Plugin Name:  Nouvello Sale Addons				    													*
*  Author: NouvelloThemes                                                 *
*  Version: 1.0.0                                                         *
---------------------------------------------------------------------------
*/


jQuery(document).ready(function($) {

	"use strict";

	var body = $('body');

	// Envato purchase button
	if ( undefined != psnsa_params.item_page && '' != psnsa_params.item_page ) {

		var splentPurchasePage = psnsa_params.item_page+'?s_rank=1?ref=audiopets&license=regular&open_purchase_for_item_id=24901478&purchasable=source',
			envatoPurchaseBtn = '<a target="_blank" class="purchase-theme envato-btn" href="'+splentPurchasePage+'">'+
													'<i class="envato-icon">'+
													'<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="14px" height="16px" viewBox="0 0 14 16" style="enable-background:new 0 0 14 16;" xml:space="preserve"><path class="st0" d="M11.9,0.1C11.5-0.1,10.1,0,8.5,0.5c-2.8,2-5.2,4.8-5.4,9.4c0,0.1-0.3,0-0.4,0C2,8.4,1.7,6.8,2.3,4.6C2.5,4.4,2.1,4.2,2,4.2C1.9,4.4,1.3,5,0.9,5.7C-1,9,0.2,13.3,3.6,15.1c3.4,1.9,7.6,0.7,9.5-2.7C15.2,8.5,13.2,0.8,11.9,0.1L11.9,0.1z"/></svg>'+
													'</i>Purchase</a>';
		body.append(envatoPurchaseBtn);
	}	

	// dark / bright switch
	if ( 'true' == psnsa_params.show_switch && 'page' != psnsa_params.post_type ) {
		var splentModeSwitch2 = '<div class="flipswitch">'+
														    '<input type="checkbox" name="flipswitch" class="flipswitch-cb" id="fs" ' + ( body.hasClass('dark') ? '' : 'checked' ) +'>'+
														    '<label class="flipswitch-label" for="fs">'+
														        '<div class="flipswitch-inner"></div>'+
														        '<div class="flipswitch-switch"></div>'+
														    '</label>'+
														'</div>';

		body.append(splentModeSwitch2);

		$('.flipswitch-cb').on('click', function(e){
			e.stopPropagation();
			body.toggleClass('dark');
		});
	}

	// vertical scroll 
	if ( 'true' == psnsa_params.show_vertical_scroll ) {

		let vertScollMarkup = `
			<a class="zanaya-vertical-scroll-top hidden-xs" id="zanaya-vertical-scroll-top">
				<div class="zanaya-vertical-scroll-top-bar">
					<div class="scroll-track"></div>
				</div>
				<div class="zanaya-vertical-scroll-top-holder">
					Scroll to top	</div>
			</a>
			<div class="zanaya-vertical-social hidden-xs">
			  <ul class="zanaya-vertical-social-holder"> 
					<li class="zanaya-vertical-social-holder-follow">Follow Us</li>
					<li class="zanaya-vertical-social-holder-dash">â€“</li>
					<li><a href="javascript:void(0)" class="facebook">Fb.</a></li>
					<li><a href="javascript:void(0)" class="twitter">Tw.</a></li>
					<li><a href="javascript:void(0)" class="instagram">Inst.</a></li>
			  </ul>
			</div>
		`;

		body.append(vertScollMarkup);

		if ( $('#zanaya-vertical-scroll-top').length > 0 ) {

			var $_win = $(window),
					vertScrollTop = $('#zanaya-vertical-scroll-top'),
					bodyH = body.height();
			// vert scroll show/hide + track width
			$_win.on('scroll', function(){
				var t = ( $_win.innerHeight() + $_win.scrollTop() ) / bodyH * 100;
				// scroll to top track width
				$('.zanaya-vertical-scroll-top:not(.zanaya-slider-scroll-top) .scroll-track').css('width', t + '%');

				// show hide scroll to top
				if (  $(window).scrollTop() > 250 ) {
					vertScrollTop.addClass('visible');
				} else {
					vertScrollTop.removeClass('visible');
				}
			});

			// scroll top click event
			vertScrollTop.on('click', function() {
				return $('html, body').animate({
					scrollTop: 0
				}, 800);
	    }); 

		}

	}


	// contact option 
	if ( 'true' == psnsa_params.show_contact_icon ) {

		const svg =`<svg id="svg-envelope-animate" width="25px" height="27px" viewBox="0 0 25 27" version="1.1"
       xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
	    <title>envelope</title>
	    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
	      <g id="bottom-envelope">
	        <path class="svg-envolope-color" id="mail-envelope-open-path-copy-2" fill="#8D8D8D"
	              d="M12.5,0 L25,11 L25,25.0059397 C25,26.1054862 24.10296,27 22.9964051,27 L2.00359486,27 C0.88976324,27 0,26.1072288 0,25.0059397 L0,11 L12.5,0 Z"></path>
	        <path id="mail-envelope-open-path" fill="#000000" class="dynamic-fill"
	              d="M12.5,1.30000019 L1.54687503,10.9909992 L1.54687503,22.190589 L23.4415036,22.190589 L23.4415031,10.9909992 L14.4278349,3 L12.5,1.30000019 Z"></path>
	      </g>
	      <g id="paper" transform="translate(3.000000, 3.000000)">
	        <path class="svg-envolope-color" id="mail-envelope-open-path-copy" fill="#8D8D8D"
	              d="M17.0025781,-8.8817842e-16 C18.1090746,-8.8817842e-16 19,0.89525812 19,1.99961498 L19,5.36 L19.0000008,16 L1.0191048e-09,16 L-1.33226763e-15,5.36 L-1.33226763e-15,1.99961498 C-1.33226763e-15,0.88743329 0.89427625,-8.8817842e-16 1.99742191,-8.8817842e-16 L17.0025781,-8.8817842e-16 Z"></path>
	        <path id="mail-envelope-open-path" fill="#000000" class="dynamic-fill"
	              d="M18,2.00862577 C18,1.45157714 17.5452911,1 17.0000398,1 L1.9999602,1 C1.44769743,1 1,1.44373571 1,2.00207596 L1,16.0313873 L18,16.0313873 L18,2.00862577 Z"></path>
	        <path class="svg-envolope-color" id="mail-envelope-open-path" fill="#8D8D8D"
	              d="M3,4 L3,5 L16,5 L16,4 L3,4 L3,4 L3,4 Z"></path>
	        <path class="svg-envolope-color" id="mail-envelope-open-path" fill="#8D8D8D"
	              d="M3,7 L3,8 L16,8 L16,7 L3,7 L3,7 L3,7 Z"></path>
	        <path class="svg-envolope-color" id="mail-envelope-open-path" fill="#8D8D8D"
	              d="M3,13 L3,14 L16,14 L16,13 L3,13 L3,13 L3,13 Z"></path>
	        <path class="svg-envolope-color" id="mail-envelope-open-path" fill="#8D8D8D"
	              d="M3,10 L3,11 L16,11 L16,10 L3,10 L3,10 L3,10 Z"></path>
	      </g>
	      <g id="upper-envelope" transform="translate(0.000000, 11.000000)">
	        <path class="svg-envolope-color" id="TOP" fill="#8D8D8D"
	              d="M1.484375,8.8817842e-16 L10.5625,8 L14.4375,8 L22.7146597,0.604003909 C22.7146597,0.604003909 23.390625,0 23.390625,0 L25,8.8817842e-16 L25,14.0059397 C25,15.1054862 24.10296,16 22.9964051,16 L2.00359486,16 C0.88976324,16 0,15.1072288 0,14.0059397 L0,8.8817842e-16 L1.484375,8.8817842e-16 Z"></path>
	        <path id="mail-envelope-open-path" fill="#000000" class="dynamic-fill"
	              d="M9.5,9 L2.5,15 L22.5,15 L15.5,9 L9.5,9 L9.5,9 L9.5,9 Z"></path>
	        <path id="mail-envelope-open-path" fill="#000000" class="dynamic-fill"
	              d="M23.68514,14.7251701 L16,8.0170898 L24,1 L24,7.5000199 L24,14.0000398 C24,14.2831537 23.8789949,14.5418569 23.68514,14.7251701 L23.68514,14.7251701 L23.68514,14.7251701 L23.68514,14.7251701 Z"></path>
	        <path id="mail-envelope-open-path" fill="#000000" class="dynamic-fill"
	              d="M9,8.0170898 L1,1 L1,7.5000199 L1,14.0000398 C1,14.2831537 1.12100514,14.5418569 1.31486,14.7251701 L9,8.0170898 Z"></path>
	      </g>
	    </g>
	  </svg>`;

		const contactIconMarkup = '<div class="contact-form-sticky hidden-xs">'+svg+'</div>';
		body.append( contactIconMarkup );

		var fixed = $('.contact-form-sticky');
		var toCross = $('.entry-content .zanaya-section')


		/* ------------------  DEBOUNCE  ------------------ */

		// Returns a function, that, as long as it continues to be invoked, will not be triggered. 
		// The function will be called after it stops being called for N milliseconds. 
		// If `immediate` is passed, trigger the function on the leading edge, instead of the trailing.
		function debounce(func, wait, immediate) {
			var timeout;
			return function() {
				var context = this,
					args = arguments;
				var later = function() {
					timeout = null;
					if (!immediate) func.apply(context, args);
				};
				var callNow = immediate && !timeout;
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
				if (callNow) func.apply(context, args);
			};
		}

		function handleDarkSectionColors() {
			var section = $('.entry-content .zanaya-section'),
					sectionClass;

			if (section.length) {
				var stickyContact = $('.contact-form-sticky'),
						selfWindow = $(window);


				var checkActiveSection = debounce(function() {
					activeSection(selfWindow);
				}, 25); // throttle by 25ms.

				window.addEventListener('scroll', checkActiveSection);

				function activeSection() {
					var st = ( 150 + selfWindow.scrollTop() + ( selfWindow.height() / 2 ) );
					section.each(function(){
						var currentSection = $(this),
								sectionOffset = currentSection.offset().top,
								currentSectionBgImage = currentSection.css('background-image');

						if ( currentSectionBgImage.indexOf('url') < 0  ) {
							var currentSectionBgColor = currentSection.css('background-color');
							if (sectionOffset + currentSection.height() > st && st > sectionOffset) {
								if ( ! currentSection.hasClass('zanaya-background') ) {
									if ( 'transparent' == currentSectionBgColor || 'rgba(0, 0, 0, 0)' == currentSectionBgColor  ) {
										$('.contact-form-sticky .dynamic-fill').css('fill', '#fff');
									} else {
										$('.contact-form-sticky .dynamic-fill').css('fill', currentSectionBgColor);
									}
								} else {
									$('.contact-form-sticky .dynamic-fill').css('fill', '#000000');
								}
								return false;
							} else {
								$('.contact-form-sticky .dynamic-fill').css('fill', '#000000');
							}
						}
					});
				}
			}

		}

		// handleDarkSectionColors();

	}	

}); // end of document ready