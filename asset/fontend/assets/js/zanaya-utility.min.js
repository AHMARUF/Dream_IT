/*  
----------------------------------------------------------------------------
*  Theme Name: Splent - Responsive Multi Purpose Templates w page builder  *
*  Author: NouvelloThemes                                                  *
*  Version: 1.0.0                                                          *
----------------------------------------------------------------------------
*/


/* Contents:

  1.  Preloader Presets
  2.  Cross Browser Compability

*/
document.addEventListener("DOMContentLoaded", function() {

	'use strict';

	/* ------------------  Preloader  ------------------ */

	// website mode	
	var documentHtml = document.getElementsByTagName('html')[0],
		documentHead = document.getElementsByTagName('head')[0], 
		documentBody = document.getElementsByTagName('body')[0],
		proloaderDiv,
		preloaderMarkup,
		styles,
		preLoader;

	if ( undefined == theme_design_options.enable_preloader || true == theme_design_options.enable_preloader ) {
		// create preloader
		proloaderDiv = document.createElement('div');
		proloaderDiv.id = 'zanaya-preloader-wrap';
		if (undefined != theme_design_options.settings) {
			preloaderMarkup = theme_design_options.settings.preloaderMarkup;
			proloaderDiv.innerHTML = ('' != preloaderMarkup) ? preloaderMarkup : '<div id="zanaya-preloader"></div>';
			if ( jQuery(proloaderDiv).find('[data-preloader-name]').length > 0 ) {
				var preloaderName = jQuery(proloaderDiv).find('[data-preloader-name]').attr('data-preloader-name');
				if( undefined != preloaderName && '' != preloaderName ) {
					jQuery(documentBody).addClass(preloaderName);
				}
			}
		}

		// prepend preloader to body
		documentBody.insertBefore(proloaderDiv, documentBody.childNodes[0]);
		preLoader = document.getElementById('zanaya-preloader-wrap');
	}

	if ( jQuery(documentBody).hasClass('use-slimscroll') ) {
		documentHtml.classList.add('hidden-overflow-y');	
	}	

	// remove zanaya-hidden-load class
	documentHtml.classList.remove('zanaya-hidden-load');

	// windowload event
	window.addEventListener('DOMContentLoaded', function() {

		// native fade out
		function fadeOut(el, callback) {
			el.style.opacity = 1;
			(function fade() {
				if ((el.style.opacity -= 0.1) < 0) {
					el.style.display = "none";
					// fadeout completed
					setTimeout(function() {}, 2000);
				} else {
					setTimeout(fade, 50);
				}
			})();
		}

	});

	/* ------------------  Cross Browser Compability  ------------------ */

	styles = jQuery('#zanaya-builder-post-css-inline-css');
			
	// Safari 3.0+ "[object HTMLElementConstructor]" 
	// var isSafari = /constructor/i.test(window.HTMLElement) || (function(p) {
	// 	return p.toString() === "[object SafariRemoteNotification]";
	// })(!window.safari || (typeof safari !== 'undefined' && safari.pushNotification));
	// if (true == isSafari) {
	// 	// flex wrap fix.
	// 	var flexRow = jQuery('.flex-row');
	// 	flexRow.find('.zanaya-inner-col').matchHeight();
	// 	flexRow.find('.zanaya-col').matchHeight();
	// 	flexRow.removeClass('flex-row');
	// }

	// Internet Explorer 6-11
	var isIE = /*@cc_on!@*/ false || !!document.documentMode;
	if (true == isIE) {
		// img object fit for carousels.
		jQuery(function() {
			objectFitImages();
		});
		
		if ( styles.length > 0 ) {	
			// css vars support
			styles.find('style').each(function() {
				var _this = jQuery(this),
					styles = _this.html();
				styles = styles.replace(/var\(--primary\)/g, theme_design_options.settings.primaryColors[0]);
				styles = styles.replace(/var\(--secondary\)/g, theme_design_options.settings.primaryColors[1]);
				styles = styles.replace(/var\(--white\)/g, 'rgb(255, 255, 255)');
				styles = styles.replace(/var\(--black\)/g, 'rgb(0, 0, 0)');
				styles = styles.replace(/var\(--pink\)/g, 'rgb(255, 118, 118)');
				_this.html(styles);
			});
		}

		// svg masking
		jQuery('.knockout-text-container').find('.knockout-mask-text').attr('y', '90%');
	}

	// Edge 20+
	var isEdge = !isIE && !!window.StyleMedia;
	if (true == isEdge) {
		// svg masking
		jQuery('.knockout-text-container').find('.knockout-mask-text').attr('y', '90%');
	}

	jQuery('.my-library-widget-styles').each(function(){
		var $this = jQuery(this),
				thisHtml = $this.html(),
				thisPresetName = $this.attr('data-zanaya-preset');
		$this.remove();		
		if ( undefined != thisHtml && '' != thisHtml ) {
			jQuery(documentHead).append('<style id="zanaya-library-preset-' + thisPresetName + '-inline-css" type="text/css">' + thisHtml + '</style>')
		}		
	});

	// WC - css vars
	if (false == isIE) {
			if ( styles.length > 0 ) {
			styles.find('style').each(function() {
				var _this = jQuery(this),
					styles = _this.html();
				styles = styles.replace(/var\(--primary\)/g, theme_design_options.settings.primaryColors[0]);
				styles = styles.replace(/var\(--secondary\)/g, theme_design_options.settings.primaryColors[1]);
				styles = styles.replace(/var\(--white\)/g, 'rgb(255, 255, 255)');
				styles = styles.replace(/var\(--black\)/g, 'rgb(0, 0, 0)');
				styles = styles.replace(/var\(--pink\)/g, 'rgb(255, 118, 118)');
				_this.html(styles);
			});
		}
	}

	// Theme unit
	jQuery('.has-large-font-size').next().css({
		'line-height': '1.4'
	});


	// New Nouvello Page
	jQuery('#wp-admin-bar-new-nouvello-page').on('click', function(e){
		e.preventDefault();
		jQuery.ajax({
			url: theme_design_options.ajax_url,
			type: 'POST',
			data: {
					'action': 'splent_new_zanaya_page',
					'nonce': theme_design_options.ajax_nonce
			},
			cache: false,
			success: function(data) {
				if ( 'zanaya_builder_not_installed' == data ) {
					console.log('Builder not installed.');
				} else{
					try {
						var jsonData = JSON.parse( data );
						if ( undefined != jsonData && undefined != jsonData.new_page_url ) {
							var redirect_url = decodeURIComponent(jsonData.new_page_url).replace('&#038;', '&');
							window.location = redirect_url;
						}                           
					} catch (e) {
						console.log(e);     
					}
				}
			}
		});
	});	

});